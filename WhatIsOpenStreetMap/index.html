<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <title>What is OpenStreetMap</title>
    <!-- unsemantic -->
    <!--[if lt IE 9]>
  <script src="./assets/javascripts/html5.js"></script>
<![endif]-->
<link rel="stylesheet" href="./assets/stylesheets/demo.css" />
<link rel="stylesheet" href="./assets/stylesheets/unsemantic-grid-base.css" />
<noscript>
  <link rel="stylesheet" href="./assets/stylesheets/unsemantic-grid-mobile.css" />
</noscript>
<script>
  var ADAPT_CONFIG = {
    path: './assets/stylesheets/',
    dynamic: true,
    range: [
      '0 to 767px = unsemantic-grid-mobile.css',
      '767px = unsemantic-grid-desktop.css'
    ]
  };
</script>
<script src="./assets/javascripts/adapt.min.js"></script>
<!-- end of unsemantic -->

    <style type="text/css">
        .item{
            width: 400px;
        }
        .map {
            height: 400px;
            width: 100%;
        }
        pre {outline: 1px solid #ccc; padding: 5px; margin: 5px; }
        .string { color: green; }
        .number { color: darkorange; }
        .boolean { color: blue; }
        .null { color: magenta; }
        .key { color: red; }
        #geojson {
            overflow:scroll;
            height: 380px;
            text-align: left;
        }
        #results {
            height: 300px;
            overflow: scroll;
        }
        table {
            border-collapse:collapse;
        }
        table,th, td {
            border: 1px solid black;
        }
        #wikipedia {
            text-align:left;
            border:1px solid gray;
            margin-bottom:5px;
            padding: 5px 5px;
        }
    </style>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
    <script src="OSMBuildings-Leaflet.js"></script>
    <script src="TileLayer.GeoJSON.js"></script>
</head>
<body>
    <div class="grid-container">

<div class="grid-100">
    <h1>What is OpenStreetMap?</h1>
<div id="wikipedia">
<b>"OpenStreetMap"</b> <i>Wikipedia: the free encyclopedia</i>
<p>
    OpenStreetMap (OSM) is a collaborative project to create a free editable map of the world. Two major driving forces behind the establishment and growth of OSM have been restrictions on use or availability of map information across much of the world and the advent of inexpensive portable satellite navigation devices.
</p>
<p>
Created by Steve Coast in the UK in 2004, it was inspired by the success of Wikipedia and preponderance of proprietary map data in the UK and elsewhere. Since then, it has grown to over 1 million registered users, who can collect data using GPS devices, aerial photography, and other free sources. These crowdsourced data are then made available under the Open Database License. The site is supported by the OpenStreetMap Foundation, a non-profit organization registered in England.
</p>
<p>
Rather than the map itself, the data generated by the OpenStreetMap project are considered its primary output. These data are then available for use in both traditional applications, like their usage by Craigslist, Geocaching, MapQuest Open, JMP statistical software, and Foursquare to replace Google Maps, and more unusual roles, like replacing default data included with GPS receivers. These data have been favourably compared with proprietary datasources, though data quality varies worldwide.
</p>
</div>

</div>


<div class="grid-50">
    <div id="language" class="map"></div>
    <h3>Multilingual</h3>
</div>

<div class="grid-50">
    <div id="3dmap" class="map"></div>
    <h3>3D Buildings</h3>
</div>

<div class="grid-50">
    <div id="outdoors" class="map"></div>
    <h3>Topographic Maps</h3>
</div>

<div class="grid-50">
    <div id="watercolor" class="map"></div>
    <h3>Art</h3>
</div>

<div class="grid-100">
    <h2>GeoJson</h2>
</div>

<div class="grid-50">
    <pre id="geojson" class="map"></pre>
</div>

<div class="grid-50">
    <div id="geojsonmap" class="map"></div>
</div>

<div class="grid-100">
    <h3>Routing</h3>
    <div id="routingBar" style="width:25%;height=400px;float:left">
        <form id="routingForm">
        <input type="text" name="start" id="start" size="30"></input>
        to
        <input type="text" name="end" id="end" size="30"></input>
        <button type="button" onclick="directions_search();">Directions</button>
        </form>
        <table style="overflow:scroll" id="directions">
        </table>
    </div>
    <div id="routingMap" class="map" style="width:75%"></div>
    <p>Directions Courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png"></p>
</div>

<div class="grid-50">
    <h3>Search</h3>
    <div id="search" style="height:400px">
        <input type="text" name="addr" value="" id="addr" size="70"></input>
        <button type="button" onclick="addr_search();">Search</button>
        <table id="results"></table>
    </div>
</div>

<div class="grid-50">
<iframe src="http://www.openstreetmap.org/stats/data_stats.html" style="height:400px;width:100%"></iframe>
</div>

<div class="grid-100">
    Map Data by <a target="_top" href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.
</div>

</div>

<script>
var mapOptions = { zoomControl:false, scrollWheelZoom:false };
var map3d = new L.Map('3dmap', mapOptions).setView([37.7943, -122.3992], 16);
L.tileLayer('http://b.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18
}).addTo(map3d);
var osmb = new OSMBuildings(map3d).loadData();

var watercolor = new L.Map('watercolor', mapOptions).setView([37.7943, -122.3992], 11);
L.tileLayer('http://a.tile.stamen.com/watercolor/{z}/{x}/{y}.png', {
    attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a target="_top" href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>.',
    maxZoom: 18
}).addTo(watercolor);

var outdoors = new L.Map('outdoors', mapOptions).setView([38.8568, -120.15], 12);
L.tileLayer('http://a.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png', {
    attribution: 'Map tiles by <a href="http://www.thunderforest.com"/>Thunderforest</a>.',
    maxZoom: 18
}).addTo(outdoors);

var language = new L.Map('language', mapOptions).setView([34.7783, 127.6544], 8);
L.tileLayer('http://a.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18
}).addTo(language);

var routeMap = new L.Map('routingMap', mapOptions).setView([0, 0], 2);
L.tileLayer('http://a.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18
}).addTo(routeMap);

var routeLayer = L.featureGroup().addTo(routeMap);

var geojsonmap = new L.Map('geojsonmap', mapOptions).setView([37.7943, -122.3992], 15);
  var style = {
        "clickable": true,
        "color": "#00D",
        "fillColor": "#00D",
        "weight": 1.0,
        "opacity": 0.3,
        "fillOpacity": 0.2
    };
    var hoverStyle = {
        "fillOpacity": 0.5
    };

    var geojsonURL = 'http://tile.openstreetmap.us/vectiles-highroad/{z}/{x}/{y}.json';
    var geojsonTileLayer = new L.TileLayer.GeoJSON(geojsonURL, {
            clipTiles: true,
            attribution : 'Vector tiles from <a href="http://openstreetmap.us/~migurski/vector-datasource/">openstreetmap.us</a>',
            unique: function (feature) {
                return feature.id; 
            }
        }, {
            style: style,
            onEachFeature: function (feature, layer) {
                if (feature.properties) {
                    var popupString = '<div class="popup">';
                    for (var k in feature.properties) {
                        var v = feature.properties[k];
                        popupString += k + ': ' + v + '<br />';
                    }
                    popupString += '</div>';
                    layer.bindPopup(popupString);
                }
                if (!(layer instanceof L.Point)) {
                    layer.on('mouseover', function () {
                        layer.setStyle(hoverStyle);
                    });
                    layer.on('mouseout', function () {
                        layer.setStyle(style);
                    });
                }
            }
        }
    );
    geojsonmap.addLayer(geojsonTileLayer);

    var geojsonURL = 'http://tile.openstreetmap.us/vectiles-pois/{z}/{x}/{y}.json';
    var geojsonTileLayer = new L.TileLayer.GeoJSON(geojsonURL, {
            clipTiles: true,
            unique: function (feature) {
                return feature.id; 
            }
        }, {
            style: style,
            onEachFeature: function (feature, layer) {
                if (feature.properties) {
                    var popupString = '<div class="popup">';
                    for (var k in feature.properties) {
                        var v = feature.properties[k];
                        popupString += k + ': ' + v + '<br />';
                    }
                    popupString += '</div>';
                    layer.bindPopup(popupString);
                }
                if (!(layer instanceof L.Point)) {
                    layer.on('mouseover', function () {
                        layer.setStyle(hoverStyle);
                    });
                    layer.on('mouseout', function () {
                        layer.setStyle(style);
                    });
                }
            }
        }
    );
    geojsonmap.addLayer(geojsonTileLayer);


function syntaxHighlight(json) {
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
        var cls = 'number';
        if (/^"/.test(match)) {
            if (/:$/.test(match)) {
                cls = 'key';
            } else {
                cls = 'string';
            }
        } else if (/true|false/.test(match)) {
            cls = 'boolean';
        } else if (/null/.test(match)) {
            cls = 'null';
        }
        return '<span class="' + cls + '">' + match + '</span>';
    });
}

request = new XMLHttpRequest;
request.open('GET', '16-10487-25327.json', true);
request.onload = function() {
  if (request.status >= 200 && request.status < 400){
    var data = JSON.parse(request.responseText)
    var str = JSON.stringify(data, undefined, 4);
    geojson.innerHTML = syntaxHighlight(str);
  }
}
request.send();

function addr_search() {
    var inp = document.getElementById("addr");
    search(inp.value, 10, function(searchResponse){
        while(results.rows.length > 0) {
            results.deleteRow(0);
        }
        for (var i = 0; i < searchResponse.length; i++) {
                var r = searchResponse[i];
                var row = results.insertRow(-1);
                var c0 = row.insertCell(0);
                var c1 = row.insertCell(1);
                var c2 = row.insertCell(2);
                var c3 = row.insertCell(3);
                if(r['icon']) {
                    c0.innerHTML = '<img src="' + r['icon'] + '" />';
                }
                c1.innerHTML = r['type'];
                c2.innerHTML = r['display_name'];
                c3.innerHTML = r['lat'] + "," + r['lon'];
        };
    });
}


function search(query, limit, callback) {
    searchRequest = new XMLHttpRequest;
    searchRequest.open('GET', 'http://nominatim.openstreetmap.org/search?format=json&limit=' + limit + '&q=' + query, true);
    searchRequest.onload = function() {
        if (searchRequest.status >= 200 && searchRequest.status < 400){
            var searchResponse = JSON.parse(searchRequest.responseText);
            callback(searchResponse);
        }
    }
    searchRequest.send();
}


function directions_search() {
    var startField = document.getElementById("start");
    var endField = document.getElementById("end");
    search(startField.value, 1, function(startResponse) {
        if(startResponse.size == 0) {

        } else {
            routeLayer.clearLayers();
            var startLoc = startResponse[0];
            search(endField.value, 1, function(endResponse){
                if(endResponse.size == 0 ) {

                } else {
                    var endLoc = endResponse[0];
                    var key = "Fmjtd%7Cluur216yll%2Ca0%3Do5-90tlqy";
                    var url = "http://open.mapquestapi.com/directions/v2/route?key=" + key +
                        "&from=" + startLoc['lat'] + "," + startLoc['lon'] +
                        "&to=" + endLoc['lat'] + "," + endLoc['lon'] +
                        "&callback=handleDirectionResponse&destinationManeuverDisplay=true"
                    directionsRequest = new XMLHttpRequest;
                    directionsRequest.open('GET', url, true);
                    directionsRequest.onload = function() {
                        if (directionsRequest.status >= 200 && directionsRequest.status < 400){
                            eval(directionsRequest.responseText);
                        }
                    }
                    directionsRequest.send();
                }
            });
        }
    });
}


function handleDirectionResponse(directions) {
    var directionsTable = document.getElementById("directions");
    while(directionsTable.rows.length > 0) {
        directionsTable.deleteRow(0);
    }

    var legs = directions['route']['legs'];
    for (var l = 0; l < legs.length; l++) {
        var leg = legs[l];
        var points = [];
        var maneuvers = leg['maneuvers'];
        for (var i = 0; i < maneuvers.length; i++) {
            var m = maneuvers[i];
            var point = m['startPoint'];
            points[i] = L.latLng(point['lat'], point['lng']);
            var marker = L.marker(points[i]);
            marker.bindPopup(m['narrative']);
            routeLayer.addLayer(marker);

            var row = directionsTable.insertRow(-1);
            var c0 = row.insertCell(0);
            c0.innerHTML = '<img src="' + m['iconUrl'] + '"></img>';
            var c1 = row.insertCell(1);
            c1.innerHTML = m['narrative'];
        };
        var polyline = L.polyline(points, {color: 'red'});
        routeLayer.addLayer(polyline);
        routeMap.fitBounds(routeLayer.getBounds());
    }
}

</script>

</body>
</html>
